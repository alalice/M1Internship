---
title: "Exploration DIVAT other_grafts"
author: "alice"
date: "2024-04-16"
output: html_document
---

```{r}
suppressWarnings(library(Hmisc))
suppressWarnings(library(readxl))
suppressWarnings(library(corrplot))
suppressWarnings(library(gplots))
#coltype <- c("guess","text","guess","guess","guess","text")
biopsy <- read_excel("C:\\Alice\\1-Universitée\\Stages\\M1-centrale\\DATAS\\ALICE_DATAS\\ALL_VARIABLES_KiTGENIE2024.xlsx", sheet = "biopsy",na = "NA",col_types = "text")
```

```{r}
biobsy_N_test <- as.numeric(biopsy$id_g)
biobsy_N <- biopsy[biopsy$id_g == biobsy_N_test,]
biobsy_N <- biobsy_N[complete.cases(biobsy_N$id_g),]
```
Description of the datas
```{r}
describe(biobsy_N)
```
missing (NA) : - other_nephro_viral_details_biopsy : 3848/3851 -> remove column
               - nephro_pdn_detail_biopsy : 3802/3851 -> remove colum
               - indication_biopsy : 88 -> remove (to much diffent texts)
               - other_nephro_viral_biopsy : 615 -> replace by 0 (99,9% of the datas)
               - necrose_cort_biospy : 615 -> replace by 0 (99,6% of the datas)
               - mat_biopsy : 615 -> replace by 0 (98,2% of the datas)
               - tox_cni_biopsy : 615 -> 0 (97%)
               - nephro_bk_biopsy : 615 -> 0 (97,3%)
               - necrose_tub_aigu_biopsy : 615 -> 0 (95,8%)
               - nephro_pdn_biopsy : 615 -> 0 (98,3%)
               - recidive_biopsy : 615 -> 0 (95,4)
               - other_lesion_biopsy : 615 -> 0 (82,4%)
               - fiat_grade_biopsy : 2235 -> corresponding to "no fiat" + missing fiat_biopsy, replace by this
               - fiat_biopsy : 629 -> replace by random proportional.
               - rejet_humoral_aigue_chronic_biopsy : 1136 -> replace by 0 ?
               - rejet_humoral_aigue_grade_biopsy : 3826 -> replace by "no reject" ?
               - rejet_humoral_aigue_biopsy : 1164 -> replace by 0 or suspicion or random
               - rejet_humoral_biopsy : 639 -> replace by 0 or suspicion or random
               - rejet_cellular_aigue_chronic_biopsy : 1132 -> replace by 0 or suspicion or random
               - rejet_cellular_aigue_grade_biopsy : 3610 -> replace by "no rejection" ?
               - rejet_cellular_aigue_biopsy : 1066 -> replace by 0 or suspicion or random
               - rejet_cellular_biopsy -> 648 -> replace by 0 or random ?
               - rejet_borderline_biopsy -> 614 -> replace by 0 or random ?
               - pbr_normal_biopsy : 98 -> random
               - c4d_prec_biopsy : 803 -> replace by "no cd4" ?
               - c4d_biopsy : 179 -> replace by 1 or random ?
               - aah_biopsy : 3819 -> replace by 0 or random ?
               - ti_biopsy : 643 -> replace by 0 or random ?
               - mm_biopsy : 343 -> replace by 0 or random ?
               - ah_biopsy : 264 -> replace by 0 or random ?
               - cv_biopsy : 594 -> replace by 0 or random ?
               - ct_biopsy : 286 -> replace by 0 or random ?
               - ci_biopsy : 286 -> replace by 0 or random ?
               - cg_biopsy : 320 -> replace by 0 or random ?
               - iifta_biopsy : 3278 -> replace by 0 or random ?
               - cpt_biopsy : 750 -> replace by 0 or random ?
               - v_biopsy : 324 -> replace by 0 or random ?
               - t_biopsy : 254 -> replace by 0 or random ?
               - i_biopsy : 255 -> replace by 0 or random ?
               - g_biopsy : 282 -> replace by 0 or random ?
               - pbr_indic_biopsy : 136 -> replace by random
               - quality_biopsy : 45 -> replace by random
               - coupArt_nb_biopsy : 3261 (no "coupe artérielle" ?) -> 0
               - pac_nb_biopsy : 198 -> replace by random
               - glomeruli_nb_biopsy : 112 -> replace by random
               

Recodage du rejet :

Remove rejet humoral aigue grade (not an of datas)
```{r}
biobsy_N_1<- biobsy_N[,-c(8,18,26,33,37,45,52)]
```

1/ If diag_rejet == NA, le sortir du tableau
```{r}
biobsy_N_1 <- biobsy_N_1[is.na(biobsy_N$diag_rejet_pbr_biopsy) == FALSE,]
```

2/ If diag_rejet == 0, mettre les autre rej = 0
```{r}
biobsy_N_1$rejet_borderline_biopsy[biobsy_N_1$diag_rejet_pbr_biopsy == 0 ]<- 0
biobsy_N_1$rejet_cellular_aigue_biopsy[biobsy_N_1$diag_rejet_pbr_biopsy == 0 ]<- 0
biobsy_N_1$rejet_cellular_biopsy[biobsy_N_1$diag_rejet_pbr_biopsy == 0 ]<- 0
biobsy_N_1$rejet_cellular_aigue_grade_biopsy[biobsy_N_1$diag_rejet_pbr_biopsy == 0 ]<- 0
biobsy_N_1$rejet_humoral_aigue_biopsy[biobsy_N_1$diag_rejet_pbr_biopsy == 0 ]<- 0
biobsy_N_1$rejet_humoral_aigue_chronic_biopsy[biobsy_N_1$diag_rejet_pbr_biopsy == 0 ]<- 0
#biobsy_N_1$rejet_humoral_aigue_grade_biopsy[biobsy_N_1$diag_rejet_pbr_biopsy == 0 ]<- 0
biobsy_N_1$rejet_humoral_biopsy[biobsy_N_1$diag_rejet_pbr_biopsy == 0 ]<- 0
#biobsy_N_1$rejet_cellular_aigue_chronic_biopsy[biobsy_N_1$diag_rejet_pbr_biopsy == 0 ]<- 0
```

Note the part of NA for each column
```{r}
dataframe1 <- data.frame(row.names = c("missing","part","coments") )
lenght<- length(biobsy_N_1$id_g)
sum <- 0
for (col in names(biobsy_N_1)) {
  if(sum(is.na(biobsy_N_1[[col]]))!= 0){
    sum <- sum +  sum(is.na(biobsy_N_1[[col]]))
    cat(col ,":" , sum(is.na(biobsy_N_1[[col]])),sum(is.na(biobsy_N_1[[col]]))/lenght,"\n")
    #dataframe1[col] <- c(sum(is.na(biobsy_N_1[[col]])),sum(is.na(biobsy_N_1[[col]]))/lenght,"random")}
    #missing <- c(missing,sum(is.na(biobsy_N[[col]]))/lenght)
  }}
print(sum)
```

```{r}
addWorksheet(OUT, "biopsy")
writeData(OUT, sheet = "biopsy", x = biobsy_N_1,keepNA = TRUE)
```

```{r}
summary(biopsy)
```

