
---
title: "Exploration DIVAT graft_base"
author: "alice"
date: "2024-04-16"
output: html_document
---

```{r}
suppressWarnings(library(Hmisc))
suppressWarnings(library(readxl))
suppressWarnings(library(corrplot))
suppressWarnings(library(gplots))
coltypes <- c("text","text","text","text","guess","guess","guess","text","text","guess","guess","guess","guess","text","text","text","text","guess","guess","guess","guess","guess","guess","guess","text","guess","guess","guess","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text")
graft_base <- read_excel("C:\\Alice\\1-Universitée\\Stages\\M1-centrale\\DATAS\\ALICE_DATAS\\ALL_VARIABLES_KiTGENIE2024.xlsx", sheet = "graft_base",na = "NA",col_types = coltypes)
```

```{r}
graft_b_N_test <- as.numeric(graft_base$id_g)
graft_b_N <- graft_base[graft_base$id_g == graft_b_N_test,]
graft_b_N <- graft_b_N[complete.cases(graft_b_N$id_g),]
```
Remove precisions disease
```{r}
graft_b_N <- graft_b_N[,-c(16,24,25)]
```

Replace NA and add column traitement_ind
```{r}
library(dplyr)
graft_b_N$rank_g[is.na(graft_b_N$rank_g)]<-1
graft_b_N$traitement_ind <- ifelse(is.na(graft_b_N$day_ttt_ind),0,1)
graft_b_N<- graft_b_N %>% relocate(traitement_ind, .after = code_ttt_ind)
graft_b_N$day_ttt_ind[is.na(graft_b_N$day_ttt_ind)]<-0
graft_b_N$mach_perf[is.na(graft_b_N$mach_perf)]<-0
graft_b_N<- graft_b_N[graft_b_N$type_g != "P",]
table(graft_b_N$type_g)
```


```{r}
describe(graft_b_N)
```

```{r}
#dataframe <- data.frame(row.names = c("missing","part","coments") )
lenght <- length(graft_b_N$id_g)
#missing2 <- missing
#sum <- 0
for (col in names(graft_b_N)) {
  if(sum(is.na(graft_b_N[[col]]))!= 0){
    #sum <- sum + sum(is.na(graft_b_N[[col]]))
    cat(col ,":" , sum(is.na(graft_b_N[[col]]))/lenght,"\n")}
    #missing2 <- c(missing2,sum(is.na(graft_b_N[[col]]))/lenght)}
    #dataframe[col] <- c(sum(is.na(graft_b_N[[col]])),sum(is.na(graft_b_N[[col]]))/lenght,"random")}
}
print(sum)
```

```{r}
write.xlsx(dataframe, file = "C:\\Alice\\1-Universitée\\Stages\\M1-centrale\\DATAS\\Describe\\explore\\explore_NA.xlsx",sheetName = "graft_base2", append = TRUE)
```
Missing (NA) :

rank_g : 1 -> random
height_r : 19 -> random
weight_r : 20 -> random
bmi_r : 23 -> random
code_disease : 22 -> random
precision_disease : 3247 -> remove column as no data at all
delay_abm_g : 100 -> random
delay_dial_g : 648 -> no dial ?
mach_perf : 745 -> random
nb_dial_post_g : 161 -> random
day_resemption_fct_g : 106 -> random
cold_ischemia_g : 27 -> random
luk_ischemia_g : 2035 -> random
day_hospit_g : 1032 -> random ?
cmv_r : 31 -> random
ebv_r : 113 -> random
hcv_r : 34 -> random
ag_hbs_r : 29 -> random
ac_hbs_r : 75 -> random
hiv_r : 44 -> random
transfusion_r : 186 -> random
day_ttt_ind : 1508 -> ???
prophyl_pnc_g : 41 -> random
prophyl_cmv_g : 36 -> random




```{r}
library(openxlsx)
OUT <- loadWorkbook("C:\\Alice\\1-Universitée\\Stages\\M1-centrale\\DATAS\\NewDATA\\CLEAN_MERGE_new.xlsx")
removeWorksheet(OUT,"graft_base")
addWorksheet(OUT, "graft_base")
writeData(OUT, sheet = "graft_base", x = graft_b_N,keepNA = TRUE)
```

```{r}
summary(graft_base)
```



